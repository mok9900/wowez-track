<!DOCTYPE html>
<html lang="ko">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  Â  <title>ë°©ë¬¸ì ë¡œê·¸ ê´€ë¦¬ ì‹œìŠ¤í…œ</title>
Â  Â  <!-- Tailwind CSS CDN -->
Â  Â  <script src="https://cdn.tailwindcss.com"></script>
Â  Â  <!-- Firebase SDK Modules -->
Â  Â  <script type="module">
Â  Â  Â  Â  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
Â  Â  Â  Â  import { getAuth, GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
Â  Â  Â  Â  import { getFirestore, doc, deleteDoc, onSnapshot, collectionGroup, query, limit, orderBy } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
Â  Â  Â  Â  import { setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore-lite.js";

Â  Â  Â  Â  // Firestore ë¡œê·¸ ë ˆë²¨ ì„¤ì • (ë””ë²„ê¹…ìš©)
Â  Â  Â  Â  setLogLevel('Debug');

Â  Â  Â  Â  // ì „ì—­ ë³€ìˆ˜ ì´ˆê¸°í™”
Â  Â  Â  Â  let app;
Â  Â  Â  Â  let auth;
Â  Â  Â  Â  let db;
Â  Â  Â  Â  let userId = 'unknown'; // í˜„ì¬ ë¡œê·¸ì¸í•œ ì‚¬ìš©ì ID (UID)
Â  Â  Â  Â  let isManager = false; // ê´€ë¦¬ì ì—¬ë¶€ í”Œë˜ê·¸
Â  Â  Â  Â  let use12HourFormat = true; // ì‹œê°„ í‘œì‹œ í˜•ì‹ (ê¸°ë³¸ê°’: 12ì‹œê°„/AM/PM)
Â  Â  Â  Â  let currentLogs = []; // í˜„ì¬ í‘œì‹œ ì¤‘ì¸ ë¡œê·¸ ë°ì´í„° ë°°ì—´

Â  Â  Â  Â  // Firebase êµ¬ì„± ê°ì²´ (ì‚¬ìš©ì ì œê³µ ì •ë³´ë¡œ ëŒ€ì²´)
Â  Â  Â  Â  const FIREBASE_CONFIG = {
Â  Â  Â  Â  Â  Â  apiKey: "AIzaSyB1ApaFJIQWlS6dj9SGiviHyCMwlvD1mcY",
Â  Â  Â  Â  Â  Â  authDomain: "track-ez-9ecb7.firebaseapp.com",
Â  Â  Â  Â  Â  Â  projectId: "track-ez-9ecb7",
Â  Â  Â  Â  Â  Â  storageBucket: "track-ez-9ecb7.firebasestorage.app",
Â  Â  Â  Â  Â  Â  messagingSenderId: "893851585207",
Â  Â  Â  Â  Â  Â  appId: "1:893851585207:web:ba248d9bcab0d793361b32",
Â  Â  Â  Â  Â  Â  measurementId: "G-E69E7TLNZN"
Â  Â  Â  Â  };
Â  Â  Â  Â Â 
Â  Â  Â  Â  // ê´€ë¦¬ì ê¶Œí•œì„ ê°€ì§ˆ ì´ë©”ì¼ ëª©ë¡
Â  Â  Â  Â  const AUTHORIZED_USERS = [
Â  Â  Â  Â  Â  Â  "menda_427@naver.com",
Â  Â  Â  Â  Â  Â  "gs25q0818@gmail.com",
Â  Â  Â  Â  Â  Â  "gs25q0327@gmail.com"
Â  Â  Â  Â  ];

Â  Â  Â  Â  // UI ìš”ì†Œ
Â  Â  Â  Â  const statusDiv = document.getElementById('auth-status');
Â  Â  Â  Â  const loginButton = document.getElementById('google-login-btn');
Â  Â  Â  Â  const logoutButton = document.getElementById('google-logout-btn');
Â  Â  Â  Â  const adminDashboard = document.getElementById('admin-dashboard');
Â  Â  Â  Â  const logTableBody = document.getElementById('log-table-body');
Â  Â  Â  Â  const totalLogsSpan = document.getElementById('total-logs');
Â  Â  Â  Â  const timeToggleContainer = document.getElementById('time-format-toggle-container');
Â  Â  Â  Â Â 
Â  Â  Â  Â  // ì»¤ìŠ¤í…€ ëª¨ë‹¬
Â  Â  Â  Â  const confirmationModal = document.getElementById('confirmation-modal');
Â  Â  Â  Â  const modalMessage = document.getElementById('modal-message');
Â  Â  Â  Â  let currentDeleteParams = null; // {docId, logUserUid}


Â  Â  Â  Â  // Firebase ì´ˆê¸°í™” ë° ì¸ì¦ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
Â  Â  Â  Â  const initFirebase = () => {
Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  // Firebase ì´ˆê¸°í™” (ì‚¬ìš©ì ì •ì˜ ì„¤ì • ì‚¬ìš©)
Â  Â  Â  Â  Â  Â  Â  Â  app = initializeApp(FIREBASE_CONFIG);
Â  Â  Â  Â  Â  Â  Â  Â  auth = getAuth(app);
Â  Â  Â  Â  Â  Â  Â  Â  db = getFirestore(app);

Â  Â  Â  Â  Â  Â  Â  Â  // ì¸ì¦ ìƒíƒœ ë³€ê²½ ë¦¬ìŠ¤ë„ˆ
Â  Â  Â  Â  Â  Â  Â  Â  onAuthStateChanged(auth, (user) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (user) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  userId = user.uid;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const userEmail = user.email;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  isManager = AUTHORIZED_USERS.includes(userEmail);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  updateUI(userEmail, isManager);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (isManager) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  fetchLogs();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.warn(`[ì ‘ê·¼ ê±°ë¶€] ë¹„ì¸ê°€ëœ ê´€ë¦¬ì ì ‘ê·¼ ì‹œë„: ${userEmail}`);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // ë¡œê·¸ì•„ì›ƒ ìƒíƒœ
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  userId = 'unknown';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  isManager = false;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  updateUI(null, false);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  console.error("Firebase ì´ˆê¸°í™” ì˜¤ë¥˜:", error);
Â  Â  Â  Â  Â  Â  Â  Â  statusDiv.innerHTML = `<p class="text-red-500 font-bold">â›” Firebase ì´ˆê¸°í™” ì˜¤ë¥˜: ${error.message}</p>`;
Â  Â  Â  Â  Â  Â  Â  Â  loginButton.disabled = true;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  };

Â  Â  Â  Â  // Google ë¡œê·¸ì¸ íŒì—… í•¸ë“¤ëŸ¬
Â  Â  Â  Â  const handleGoogleSignIn = async () => {
Â  Â  Â  Â  Â  Â  const provider = new GoogleAuthProvider();
Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  await signInWithPopup(auth, provider);
Â  Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  console.error("Google íŒì—… ë¡œê·¸ì¸ ì˜¤ë¥˜:", error);
Â  Â  Â  Â  Â  Â  Â  Â  let errorMessage = `ë¡œê·¸ì¸ ì‹¤íŒ¨: ${error.message}`;
Â  Â  Â  Â  Â  Â  Â  Â  statusDiv.innerHTML = `<p class="text-red-400 font-bold mt-4 p-3 bg-gray-700 rounded-lg">${errorMessage}</p>`;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  };
Â  Â  Â  Â Â 
Â  Â  Â  Â  // UI ìƒíƒœ ì—…ë°ì´íŠ¸
Â  Â  Â  Â  const updateUI = (email, isManager) => {
Â  Â  Â  Â  Â  Â  loginButton.classList.add('hidden');
Â  Â  Â  Â  Â  Â  logoutButton.classList.add('hidden');
Â  Â  Â  Â  Â  Â  adminDashboard.classList.add('hidden');
Â  Â  Â  Â  Â  Â  timeToggleContainer.classList.add('hidden');
Â  Â  Â  Â  Â  Â  statusDiv.classList.remove('hidden');

Â  Â  Â  Â  Â  Â  if (isManager) {
Â  Â  Â  Â  Â  Â  Â  Â  statusDiv.innerHTML = `<p class="text-indigo-400 font-semibold">âœ… ë¡œê·¸ì¸ ì„±ê³µ. ê´€ë¦¬ì(${email})</p>`;
Â  Â  Â  Â  Â  Â  Â  Â  adminDashboard.classList.remove('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  logoutButton.classList.remove('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  timeToggleContainer.classList.remove('hidden');
Â  Â  Â  Â  Â  Â  } else if (email) {
Â  Â  Â  Â  Â  Â  Â  Â  statusDiv.innerHTML = `<p class="text-red-500 font-bold">â›” ì ‘ê·¼ ê±°ë¶€ë¨. ê³„ì •: ${email}. ê´€ë¦¬ì ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.</p>`;
Â  Â  Â  Â  Â  Â  Â  Â  logoutButton.classList.remove('hidden');
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  statusDiv.innerHTML = `<p class="text-gray-400">ë¡œê·¸ì¸ë˜ì§€ ì•Šì€ ì‚¬ìš©ìì…ë‹ˆë‹¤.</p>`;
Â  Â  Â  Â  Â  Â  Â  Â  loginButton.classList.remove('hidden');
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  };

Â  Â  Â  Â  // ë¡œê·¸ë¥¼ í…Œì´ë¸”ì— ë Œë”ë§í•˜ëŠ” í•¨ìˆ˜
Â  Â  Â  Â  const renderLogs = (logs) => {
Â  Â  Â  Â  Â  Â  logTableBody.innerHTML = '';Â 
Â  Â  Â  Â  Â  Â  totalLogsSpan.textContent = logs.length.toString();
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if (logs.length === 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â logTableBody.innerHTML = `<tr><td colspan="7" class="p-6 text-center text-gray-500">ì¡°íšŒëœ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>`;
Â  Â  Â  Â  Â  Â  Â  Â  Â return;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  const truncateText = (text, maxLength = 20) => {
Â  Â  Â  Â  Â  Â  Â  Â  // null ë˜ëŠ” undefined ì²´í¬ë¥¼ ì¶”ê°€í•˜ì—¬ ì˜¤ë¥˜ ë°©ì§€
Â  Â  Â  Â  Â  Â  Â  Â  const safeText = text || "";Â 
Â  Â  Â  Â  Â  Â  Â  Â  return safeText.length > maxLength ? safeText.substring(0, maxLength) + '...' : safeText;
Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  logs.forEach(log => {
Â  Â  Â  Â  Â  Â  Â  Â  const dateOptions = {Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  year: 'numeric', month: 'numeric', day: 'numeric',Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  hour: '2-digit', minute: '2-digit', second: '2-digit',Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  hour12: use12HourFormatÂ 
Â  Â  Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // Firestore Timestamp ê°ì²´ë¥¼ Date ê°ì²´ë¡œ ë³€í™˜
Â  Â  Â  Â  Â  Â  Â  Â  const timeStr = log.timestamp.toDate().toLocaleString('ko-KR', dateOptions);

Â  Â  Â  Â  Â  Â  Â  Â  const row = document.createElement('tr');
Â  Â  Â  Â  Â  Â  Â  Â  row.className = 'border-b border-gray-700 hover:bg-gray-700 transition duration-150';
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // â­â­â­ í•µì‹¬ ìˆ˜ì •: Firestore í•„ë“œ ì´ë¦„ì— ë§ê²Œ ë°ì´í„° ì°¸ì¡° ì—…ë°ì´íŠ¸ â­â­â­
Â  Â  Â  Â  Â  Â  Â  Â  const displayUserId = log.user_id || log.userUid || 'N/A'; // user_idê°€ ê¸°ë³¸, ì—†ìœ¼ë©´ userUid ì‚¬ìš©
Â  Â  Â  Â  Â  Â  Â  Â  const displayCountry = log.location_country || 'N/A'; // location_countryë¡œ ìˆ˜ì •
Â  Â  Â  Â  Â  Â  Â  Â  const displayISP = log.isp_info || 'N/A';           // isp_infoë¡œ ìˆ˜ì •
Â  Â  Â  Â  Â  Â  Â  Â  const displayIP = log.ip_address || 'N/A';          // ip_addressëŠ” ê·¸ëŒ€ë¡œ ìœ ì§€


Â  Â  Â  Â  Â  Â  Â  Â  row.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td class="p-4 whitespace-nowrap text-sm text-gray-300 font-mono">${timeStr}</td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td class="p-4 whitespace-nowrap text-sm text-indigo-400 truncate max-w-xs" title="${displayUserId}">${truncateText(displayUserId, 15)}</td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td class="p-4 whitespace-nowrap text-sm text-gray-300">${displayIP}</td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td class="p-4 whitespace-nowrap text-sm text-gray-300">${displayCountry}</td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td class="p-4 whitespace-nowrap text-sm text-gray-300">${displayISP}</td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td class="p-4 whitespace-nowrap text-sm text-gray-400 truncate max-w-xs" title="${log.user_agent}">${truncateText(log.user_agent, 30)}</td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td class="p-4 whitespace-nowrap text-right">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <buttonÂ 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  class="delete-log-btn text-red-400 hover:text-red-500 font-medium transition duration-150 p-2 rounded-lg bg-gray-700 hover:bg-red-900/50"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  data-doc-id="${log.id}"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  data-user-uid="${log.userUid}"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onclick="handleDeleteClick(event)"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ì‚­ì œ
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </td>
Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  Â  Â  logTableBody.appendChild(row);
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  currentLogs = logs;Â 
Â  Â  Â  Â  };

Â  Â  Â  Â  // ì‹¤ì‹œê°„ ë¡œê·¸ ë°ì´í„° ê°€ì ¸ì˜¤ê¸° (onSnapshot)
Â  Â  Â  Â  const fetchLogs = () => {
Â  Â  Â  Â  Â  Â  if (!db || !auth.currentUser) {
Â  Â  Â  Â  Â  Â  Â  Â  totalLogsSpan.textContent = 'N/A'; // ì¸ì¦ì´ ì•ˆë˜ë©´ N/A
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const logsCollectionGroup = collectionGroup(db, "visitor_logs");
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const q = query(
Â  Â  Â  Â  Â  Â  Â  Â  logsCollectionGroup,Â 
Â  Â  Â  Â  Â  Â  Â  Â  orderBy('timestamp', 'desc'),Â 
Â  Â  Â  Â  Â  Â  Â  Â  limit(100)Â 
Â  Â  Â  Â  Â  Â  );Â 

Â  Â  Â  Â  Â  Â  onSnapshot(q, (snapshot) => {
Â  Â  Â  Â  Â  Â  Â  Â  const logs = [];
Â  Â  Â  Â  Â  Â  Â  Â  snapshot.forEach((doc) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const data = doc.data();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const pathParts = doc.ref.path.split('/');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const appIdFromDb = pathParts[1];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const userUidFromDb = pathParts[3];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  logs.push({Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  id: doc.id,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  appId: appIdFromDb,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  userUid: userUidFromDb,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ...dataÂ 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  renderLogs(logs);Â 
Â  Â  Â  Â  Â  Â  }, (error) => {
Â  Â  Â  Â  Â  Â  Â  Â  console.error("ë¡œê·¸ ë¶ˆëŸ¬ì˜¤ê¸° ì˜¤ë¥˜:", error);
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  totalLogsSpan.textContent = 'N/A';
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  let errorMessage = `<p class="text-red-500 font-bold mt-4">âš ï¸ ë¡œê·¸ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨: ${error.message}.</p>`;
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  if (error.code === 'permission-denied') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â errorMessage = `<p class="text-red-500 font-bold mt-4">ğŸ›‘ Firestore ê¶Œí•œ ì˜¤ë¥˜: ê´€ë¦¬ìê°€ <span class="text-yellow-400">Firebase ê·œì¹™</span>ì„ ìˆ˜ì •í•˜ì—¬ ëª¨ë“  ì‚¬ìš©ìì˜ ë¡œê·¸ë¥¼ <span class="text-yellow-400">ì½ì„ ìˆ˜ ìˆë„ë¡</span> í—ˆìš©í•´ì•¼ í•©ë‹ˆë‹¤. ì½˜ì†”ì„ í™•ì¸í•˜ì„¸ìš”.</p>`;
Â  Â  Â  Â  Â  Â  Â  Â  } else if (error.code === 'failed-precondition' && error.message.includes('query requires an index')) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  errorMessage = `<p class="text-red-500 font-bold mt-4">âš ï¸ Firestore ìƒ‰ì¸ ì˜¤ë¥˜: <span class="text-yellow-400">ê°œë°œì ì½˜ì†”(F12)ì— í‘œì‹œë˜ëŠ” ìƒ‰ì¸ ìƒì„± ë§í¬</span>ë¥¼ í´ë¦­í•˜ì—¬ ìƒ‰ì¸ì„ ìƒì„±í•´ ì£¼ì„¸ìš”. (ì´ë¯¸ ì™„ë£Œëœ ìƒíƒœì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.)</p>`;
Â  Â  Â  Â  Â  Â  Â  Â  } else if (error instanceof TypeError) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  errorMessage = `<p class="text-red-500 font-bold mt-4">ğŸš¨ ë°ì´í„° ì²˜ë¦¬ ì˜¤ë¥˜: ë¡œê·¸ ë°ì´í„° êµ¬ì¡°ê°€ ì˜ëª»ë˜ì—ˆìŠµë‹ˆë‹¤. ì½˜ì†”ì—ì„œ ë¡œê·¸ì˜ í•„ë“œë¥¼ í™•ì¸í•˜ì„¸ìš”.</p>`;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  statusDiv.innerHTML = errorMessage;
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  };
Â  Â  Â  Â Â 
Â  Â  Â  Â  // ë¡œê·¸ ì‚­ì œÂ 
Â  Â  Â  Â  const deleteLog = async (docId, logUserUid) => {
Â  Â  Â  Â  Â  Â  if (!db || !auth.currentUser) return;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // ì‚­ì œë¥¼ ìœ„í•œ AppIdëŠ” Firebase í”„ë¡œì íŠ¸ IDë¡œ ê³ ì •í•©ë‹ˆë‹¤.
Â  Â  Â  Â  Â  Â  const logAppId = FIREBASE_CONFIG.projectId;Â 
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // ì •í™•í•œ ë¬¸ì„œ ê²½ë¡œ: artifacts/{appId}/users/{userUid}/visitor_logs/{docId}
Â  Â  Â  Â  Â  Â  const docRef = doc(db, `artifacts/${logAppId}/users/${logUserUid}/visitor_logs`, docId);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  const btn = document.querySelector(`[data-doc-id="${docId}"]`);
Â  Â  Â  Â  Â  Â  Â  Â  if(btn) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  btn.textContent = 'ì‚­ì œ ì¤‘...';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  btn.disabled = true;
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  await deleteDoc(docRef);
Â  Â  Â  Â  Â  Â  Â  Â  console.log("ë¬¸ì„œ ì„±ê³µì ìœ¼ë¡œ ì‚­ì œë¨:", docRef.path);
Â  Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  console.error("ë¡œê·¸ ì‚­ì œ ì˜¤ë¥˜:", error);
Â  Â  Â  Â  Â  Â  Â  Â  statusDiv.innerHTML = `<p class="text-red-500 font-bold mt-4">ì‚­ì œ ì‹¤íŒ¨: ${error.message}. ê²½ë¡œ: ${docRef.path}</p>`;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  };

Â  Â  Â  Â  // ì „ì—­ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ë“±ë¡
Â  Â  Â  Â  window.handleGoogleSignIn = handleGoogleSignIn;
Â  Â  Â  Â  window.handleGoogleSignOut = () => signOut(auth);
Â  Â  Â  Â Â 
Â  Â  Â  Â  // -- ì»¤ìŠ¤í…€ ëª¨ë‹¬ ê´€ë ¨ í•¨ìˆ˜ --
Â  Â  Â  Â  const showModal = (message, params) => {
Â  Â  Â  Â  Â  Â  modalMessage.textContent = message;
Â  Â  Â  Â  Â  Â  currentDeleteParams = params;
Â  Â  Â  Â  Â  Â  confirmationModal.classList.remove('hidden');
Â  Â  Â  Â  };

Â  Â  Â  Â  const hideModal = () => {
Â  Â  Â  Â  Â  Â  confirmationModal.classList.add('hidden');
Â  Â  Â  Â  Â  Â  currentDeleteParams = null;
Â  Â  Â  Â  };

Â  Â  Â  Â  const handleConfirmDelete = () => {
Â  Â  Â  Â  Â  Â  if (currentDeleteParams) {
Â  Â  Â  Â  Â  Â  Â  Â  deleteLog(currentDeleteParams.docId, currentDeleteParams.logUserUid);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  hideModal();
Â  Â  Â  Â  };

Â  Â  Â  Â  // ë¡œê·¸ ì‚­ì œ í™•ì¸ ëª¨ë‹¬ íŠ¸ë¦¬ê±°
Â  Â  Â  Â  window.handleDeleteClick = (event) => {
Â  Â  Â  Â  Â  Â  const btn = event.currentTarget;
Â  Â  Â  Â  Â  Â  const params = {
Â  Â  Â  Â  Â  Â  Â  Â  docId: btn.getAttribute('data-doc-id'),
Â  Â  Â  Â  Â  Â  Â  Â  logUserUid: btn.getAttribute('data-user-uid')
Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  showModal("ì •ë§ë¡œ ì´ ë¡œê·¸ ê¸°ë¡ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?", params);
Â  Â  Â  Â  };

Â  Â  Â  Â  // ì‹œê°„ í˜•ì‹ í† ê¸€ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
Â  Â  Â  Â  window.handleTimeToggleChange = (event) => {
Â  Â  Â  Â  Â  Â  use12HourFormat = event.target.checked;
Â  Â  Â  Â  Â  Â  renderLogs(currentLogs); // ì‹œê°„ í˜•ì‹ë§Œ ë³€ê²½í•˜ì—¬ í…Œì´ë¸” ì¬ë Œë”ë§
Â  Â  Â  Â  };
Â  Â  Â  Â Â 
Â  Â  Â  Â  // Make modal handlers available globally for inline onclick
Â  Â  Â  Â  window.hideModal = hideModal;
Â  Â  Â  Â  window.handleConfirmDelete = handleConfirmDelete;

Â  Â  Â  Â  // ì´ˆê¸°í™” ì‹œì‘
Â  Â  Â  Â  initFirebase();
Â  Â  </script>
Â  Â  <style>
Â  Â  Â  Â  /* í°íŠ¸ ì„¤ì • */
Â  Â  Â  Â  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
Â  Â  Â  Â  body { font-family: 'Inter', sans-serif; }

Â  Â  Â  Â  /* í† ê¸€ ìŠ¤ìœ„ì¹˜ ë””ìì¸ */
Â  Â  Â  Â  .toggle-switch {
Â  Â  Â  Â  Â  Â  position: relative;
Â  Â  Â  Â  Â  Â  display: inline-block;
Â  Â  Â  Â  Â  Â  width: 60px;
Â  Â  Â  Â  Â  Â  height: 34px;
Â  Â  Â  Â  }

Â  Â  Â  Â  .toggle-switch input {Â 
Â  Â  Â  Â  Â  Â  opacity: 0;
Â  Â  Â  Â  Â  Â  width: 0;
Â  Â  Â  Â  Â  Â  height: 0;
Â  Â  Â  Â  }

Â  Â  Â  Â  .slider {
Â  Â  Â  Â  Â  Â  position: absolute;
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  Â  Â  top: 0;
Â  Â  Â  Â  Â  Â  left: 0;
Â  Â  Â  Â  Â  Â  right: 0;
Â  Â  Â  Â  Â  Â  bottom: 0;
Â  Â  Â  Â  Â  Â  background-color: #4B5563; /* Gray-600 */
Â  Â  Â  Â  Â  Â  transition: .4s;
Â  Â  Â  Â  Â  Â  border-radius: 34px;
Â  Â  Â  Â  }

Â  Â  Â  Â  .slider:before {
Â  Â  Â  Â  Â  Â  position: absolute;
Â  Â  Â  Â  Â  Â  content: "";
Â  Â  Â  Â  Â  Â  height: 26px;
Â  Â  Â  Â  Â  Â  width: 26px;
Â  Â  Â  Â  Â  Â  left: 4px;
Â  Â  Â  Â  Â  Â  bottom: 4px;
Â  Â  Â  Â  Â  Â  background-color: white;
Â  Â  Â  Â  Â  Â  transition: .4s;
Â  Â  Â  Â  Â  Â  border-radius: 50%;
Â  Â  Â  Â  }

Â  Â  Â  Â  input:checked + .slider {
Â  Â  Â  Â  Â  Â  background-color: #4F46E5; /* Indigo-600 */
Â  Â  Â  Â  }

Â  Â  Â  Â  input:checked + .slider:before {
Â  Â  Â  Â  Â  Â  transform: translateX(26px);
Â  Â  Â  Â  }
Â  Â  </style>
</head>
<body class="bg-slate-900 text-white min-h-screen p-4 sm:p-8">

Â  Â  <div class="max-w-7xl mx-auto">
Â  Â  Â  Â  <header class="flex flex-col sm:flex-row justify-between items-start sm:items-center border-b border-indigo-500/50 pb-4 mb-6">
Â  Â  Â  Â  Â  Â  <h1 class="text-3xl font-extrabold text-indigo-400 tracking-wider">ë°©ë¬¸ì ë¡œê·¸ ê´€ë¦¬ ì‹œìŠ¤í…œ</h1>
Â  Â  Â  Â  Â  Â  <div class="mt-4 sm:mt-0 flex items-center space-x-3">
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  <!-- ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ (ì¸ì¦ ì‹œ í‘œì‹œ) -->
Â  Â  Â  Â  Â  Â  Â  Â  <buttonÂ 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  id="google-logout-btn"Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onclick="handleGoogleSignOut()"Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  class="hidden px-4 py-2 text-sm font-semibold bg-red-600 hover:bg-red-700 text-white rounded-lg shadow-lg transition duration-150"
Â  Â  Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ë¡œê·¸ì•„ì›ƒ
Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  <!-- ì‹œê°„ í˜•ì‹ í† ê¸€ (ê´€ë¦¬ì ë¡œê·¸ì¸ ì‹œ í‘œì‹œ) -->
Â  Â  Â  Â  Â  Â  Â  Â  <div id="time-format-toggle-container" class="hidden flex items-center space-x-3">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="text-xs font-medium text-gray-400">24ì‹œê°„</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="toggle-switch">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input id="time-format-toggle" type="checkbox" checked onchange="handleTimeToggleChange(event)">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="slider"></span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="text-xs font-medium text-indigo-400">AM/PM</span>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </header>

Â  Â  Â  Â  <!-- ì¸ì¦ ìƒíƒœ ë° ë¡œê·¸ì¸ ë²„íŠ¼ -->
Â  Â  Â  Â  <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center bg-gray-800 p-6 rounded-xl shadow-2xl mb-6">
Â  Â  Â  Â  Â  Â  <div id="auth-status" class="text-lg text-gray-400">
Â  Â  Â  Â  Â  Â  Â  Â  ë¡œê·¸ì¸ ì¤‘...
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <buttonÂ 
Â  Â  Â  Â  Â  Â  Â  Â  id="google-login-btn"Â 
Â  Â  Â  Â  Â  Â  Â  Â  onclick="handleGoogleSignIn()"Â 
Â  Â  Â  Â  Â  Â  Â  Â  class="mt-4 sm:mt-0 px-6 py-3 text-lg font-bold bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg shadow-xl transition duration-300 transform hover:scale-[1.02] active:scale-[0.98]"
Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Â  Â  Google ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸
Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  </div>
Â  Â  Â  Â Â 
Â  Â  Â  Â  <!-- ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ ì˜ì—­ -->
Â  Â  Â  Â  <div id="admin-dashboard" class="hidden">
Â  Â  Â  Â  Â  Â  <h2 class="text-2xl font-bold text-gray-200 mb-4 border-b border-gray-700 pb-2">ë°©ë¬¸ì ê¸°ë¡</h2>
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  <div class="text-gray-400 mb-4">
Â  Â  Â  Â  Â  Â  Â  Â  ì´ <span id="total-logs" class="text-indigo-400 font-bold">0</span>ê°œ ê¸°ë¡
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <!-- ë¡œê·¸ í…Œì´ë¸” -->
Â  Â  Â  Â  Â  Â  <div class="overflow-x-auto bg-gray-800 rounded-xl shadow-2xl">
Â  Â  Â  Â  Â  Â  Â  Â  <table class="min-w-full divide-y divide-gray-700">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <thead class="bg-gray-700 sticky top-0">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <tr>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th class="px-4 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider w-1/6">ì‹œê°„</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th class="px-4 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider w-1/6">ì‚¬ìš©ì ID</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th class="px-4 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider w-1/12">IP ì£¼ì†Œ</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th class="px-4 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider w-1/12">êµ­ê°€</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th class="px-4 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider w-1/12">ISP</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th class="px-4 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider w-2/6">ë¸Œë¼ìš°ì €/ê¸°ê¸° ì •ë³´</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th class="px-4 py-3 text-right text-xs font-medium text-gray-300 uppercase tracking-wider w-1/12">ì‚­ì œ</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </tr>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </thead>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <tbody id="log-table-body" class="divide-y divide-gray-700/50">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <!-- ë¡œê·¸ ë°ì´í„°ê°€ ì—¬ê¸°ì— ë¡œë“œë©ë‹ˆë‹¤ -->
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </tbody>
Â  Â  Â  Â  Â  Â  Â  Â  </table>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div class="mt-4 text-center text-gray-500 text-sm">
Â  Â  Â  Â  Â  Â  Â  Â  ìµœëŒ€ 100ê°œ ê¸°ë¡ì´ í‘œì‹œë©ë‹ˆë‹¤.
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  </div>
Â  Â Â 
Â  Â  <!-- Custom Confirmation Modal -->
Â  Â  <div id="confirmation-modal" class="hidden fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50">
Â  Â  Â  Â  <div class="bg-gray-800 rounded-xl shadow-2xl p-6 w-11/12 max-w-md transform transition-all duration-300">
Â  Â  Â  Â  Â  Â  <h3 class="text-xl font-bold text-red-400 mb-4">ê¸°ë¡ ì‚­ì œ í™•ì¸</h3>
Â  Â  Â  Â  Â  Â  <p id="modal-message" class="text-gray-300 mb-6"></p>
Â  Â  Â  Â  Â  Â  <div class="flex justify-end space-x-3">
Â  Â  Â  Â  Â  Â  Â  Â  <buttonÂ 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onclick="hideModal()"Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  class="px-4 py-2 text-sm font-medium text-gray-300 bg-gray-600 hover:bg-gray-700 rounded-lg transition duration-150"
Â  Â  Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ì·¨ì†Œ
Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  <buttonÂ 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  id="confirm-delete-btn"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onclick="handleConfirmDelete()"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  class="px-4 py-2 text-sm font-medium bg-red-600 hover:bg-red-700 text-white rounded-lg transition duration-150"
Â  Â  Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ì‚­ì œ
Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  </div>

</body>
</html>
